---
import Layout from "../../layouts/Layout.astro";
import { getBlogs, getBlogDetail } from "../../library/microcms";

export async function getStaticPaths() {
  const response = await getBlogs({ fields: ["id"] });
  return response.contents.map(content => ({
    params: { blogid: content.id },
  }));
}

const { blogid } = Astro.params;
const blog = await getBlogDetail(blogid);
---

<Layout title={blog.title}>
  <head>
    <meta name="description" content={blog.content.substring(0, 160)} />
    <meta property="og:title" content={blog.title} />
    <meta property="og:description" content={blog.content.substring(0, 160)} />
    <meta property="og:type" content="article" />
    <meta
      property="og:url"
      content={`https://your-site.pages.dev/blog/${blogid}`}
    />
    <meta property="article:published_time" content={blog.publishedAt} />
    <meta property="article:modified_time" content={blog.updatedAt} />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content={blog.title} />
    <meta name="twitter:description" content={blog.content.substring(0, 160)} />
    <link rel="canonical" href={`https://your-site.pages.dev/blog/${blogid}`} />
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        headline: blog.title,
        description: blog.content.substring(0, 160),
        datePublished: blog.publishedAt,
        dateModified: blog.updatedAt,
        author: {
          "@type": "Organization",
          name: "サイト運営者",
        },
        publisher: {
          "@type": "Organization",
          name: "サイト名",
        },
        url: `https://your-site.pages.dev/blog/${blogid}`,
      })}
    />
  </head>
  <article class="blog-post">
    <header class="post-header">
      <h1 class="post-title">{blog.title}</h1>
      <p class="published-at">
        公開日時： {new Date(blog.publishedAt).toLocaleDateString("ja-JP")}
      </p>
    </header>

    <div class="post-content" set:html={blog.content} />

    <footer class="post-footer">
      <a href="/blog" class="back-to-list">← ブログ一覧に戻る</a>
    </footer>
  </article>
</Layout>

<style>
  .blog-post {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .post-header {
    margin-bottom: 2rem;
    border-bottom: 2px solid #eee;
    padding-bottom: 1rem;
  }

  .post-title {
    font-size: 2rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 0.5rem;
    line-height: 1.3;
  }

  .published-at {
    color: #666;
    font-size: 0.9rem;
    margin: 0;
  }

  .post-content {
    line-height: 1.7;
    color: #444;
  }

  .post-content h1,
  .post-content h2,
  .post-content h3,
  .post-content h4,
  .post-content h5,
  .post-content h6 {
    margin-top: 2rem;
    margin-bottom: 1rem;
    color: #333;
  }

  .post-content h1 {
    font-size: 1.8rem;
  }

  .post-content h2 {
    font-size: 1.5rem;
  }

  .post-content h3 {
    font-size: 1.3rem;
  }

  .post-content p {
    margin-bottom: 1rem;
  }

  .post-content ul,
  .post-content ol {
    margin-bottom: 1rem;
    padding-left: 2rem;
  }

  .post-content blockquote {
    border-left: 4px solid #007acc;
    padding-left: 1rem;
    margin: 1.5rem 0;
    color: #666;
    font-style: italic;
  }

  .post-content code {
    background-color: #f5f5f5;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-family: "Courier New", monospace;
    font-size: 0.9rem;
  }

  .post-content pre {
    background-color: #f5f5f5;
    padding: 1rem;
    border-radius: 5px;
    overflow-x: auto;
    margin: 1rem 0;
  }

  .post-content pre code {
    background: none;
    padding: 0;
  }

  .post-footer {
    margin-top: 3rem;
    padding-top: 1rem;
    border-top: 1px solid #eee;
  }

  .back-to-list {
    color: #007acc;
    text-decoration: none;
    font-weight: 500;
  }

  .back-to-list:hover {
    text-decoration: underline;
  }
</style>
